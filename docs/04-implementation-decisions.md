# 実装方針（決定事項）

## 0. 設計原則

- 仮説の質を標準化するツールである。出力の速さ・量より、仮説の型と質の再現性を優先する。
- とにかく早くするのは避ける。処理時間目標（60秒）は質を犠牲にしない範囲での目安とする。クロール設計で取得範囲や要約の質を落としてまで60秒に合わせない。

## 1. ユーザーフロー

URL入力 → 要約生成 → 仮説表示 → 編集 → 出力とする。画面は1画面で完結し、遷移は設けない。結果は同一画面内で下に伸ばす（スクロール）。最小クリックは①生成②エクスポート or コピーとする。

## 2. 処理時間

1社あたり60秒以内を目標とし、90秒でタイムアウトとする。30秒は中小HPの質に左右されやすく、2分はUXが重いため、60秒で思想と実用のバランスを取る。クロール・LLMはこの値で設計するが、質を削ってまで短くしない。

## 3. 再生成

再生成は1回のみ許可する。2回目以降は編集のみとする。「当たりが出るまで回すガチャ」にはしない。

## 4. 仮説5段の出力内容

各段の指示は次のとおりとする。

| 段 | ラベル | 出力内容 |
|----|--------|----------|
| 1 | 企業の現在状況整理 | 事業内容・主力製品・強み・直近の動き（HP要約ベース。事実ベースで簡潔に） |
| 2 | 潜在課題の仮説 | 「〜のような課題が考えられる」と控えめに。根拠となる情報があれば1行で。 |
| 3 | 課題の背景要因 | 「背景には〜が考えられる」。推測であることを示す表現にする。 |
| 4 | 改善機会（介入ポイント） | 「〜のようなアプローチが有効かもしれない」。押し付けない表現。 |
| 5 | 提案仮説 | 自社の打ち手と結びつけた提案の方向性。仮説であることを明示する。 |

各段は2〜4文程度とし、断定を避け、情報源はHPのみであることをプロンプトに含める。

## 5. 失敗時の表示

- タイムアウト：「取得できませんでした。URLをご確認のうえ、しばらく経ってから再試行してください。」
- 403/4xx：「このページは取得できませんでした。」
- コンテンツが空：「十分な情報が取得できませんでした。別のURL（例：会社概要ページ）をお試しください。」
- LLMエラー：「仮説の生成に失敗しました。しばらく経ってから再試行してください。」

再試行は再生成1回の枠に合わせる。

## 6. 「仮説である」表示

仮説5段の直上に「以下は、公表されている情報に基づく仮説です。実務では必ずご自身で確認してください。」を常時表示する。提案文ブロックの直上に「提案文は仮説に基づく下書きです。」を表示する。

## 7. 思想体験UI

普通のAIツールUIではなく、思想をUIで体験させる設計とする。仮説5段は折りたたみ不可で固定表示する。各段の上に思考ガイドを固定表示し、編集欄にプレースホルダで型を表示し、各段に「なぜ?」ヒントを出すことを検討する。どこまで実装するかは実装時に確定する。

## 8. エクスポート

要約・仮説5段（ラベル付き）・提案文を1つのテキストに含め、.txtでダウンロードする。形式は .txt、文字コードは UTF-8 とする。構成は（1）事業要約（見出し「■ 事業要約」）、（2）仮説5段（見出し「■ 仮説」、各段はラベル＋改行＋本文）、（3）提案文（見出し「■ 提案文下書き」）の順とする。ファイル名は`仮説_会社名_YYYYMMDD.txt`とする（会社名は入力または「不明」）。日付はエクスポート実行日とする。

## 9. 技術スタック

- ランタイム：Node.js 20+
- フロント：Next.js（App Router）+ TypeScript
- API：Next.js Route Handlers（同一リポジ）
- LLM：Groq（日次・高リクエスト無料枠）
- クローラー：fetch + cheerio（自前。同一サイト2〜3ページまで。robots.txt遵守。User-Agent明示）
- DB：Supabase（PostgreSQL）。MVPから使用する。編集・ログ・分析で思想の価値を可視化する。
- デプロイ：Railway（フロント+APIを1サービスでデプロイ）

DBはMVPから使う。思想を売るならログが必要であり、編集前後の差分が思想の価値になるため、保存しないMVPは思想を売るツールにならないと判断した。

## 10. 未決定事項

プロンプトの最終文案は第4節に基づき実装時に作成する。確証チェック（5段すべて非空の検証）の要否は実装時に決める。MVP では未実装でもよいとする。
