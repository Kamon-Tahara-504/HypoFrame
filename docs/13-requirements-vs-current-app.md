# 要件と既存アプリ（HypoFrame）の照合

依頼要件と現在の HypoFrame のフローを照らし合わせ、対応状況とギャップを整理する。

---

## 1. 既存アプリ（HypoFrame）のフロー概要

### 1.1 技術スタック・形態

| 項目 | 現状 |
|------|------|
| 実装言語 | **TypeScript / Next.js**（フロント + API Route） |
| 形態 | **Web アプリ（UI あり）**。ブラウザで操作。 |
| 生成 AI | Groq API（LLM） |
| データ保存 | Supabase（PostgreSQL）。認証・runs テーブル。 |
| クロール | Node.js（fetch + cheerio）。同一ドメイン内・最大8ページ・深度2・robots.txt 尊重。 |

### 1.2 現状の処理フロー

```
[ユーザー] 企業HPのURL + 会社名（任意）を入力
    ↓
[Page Collector] 同一ドメインから最大8ページを取得（URL優先スコア・深度2）
    ↓
[Structurizer] HTML → 本文抽出・カテゴリ別整理（解釈なし）
    ↓
[Hypothesis Engine] 要約 → 仮説5段 → 提案文下書き（Groq 3回呼び出し）
    ↓
[出力] 画面上に表示。ログイン時は DB に保存。エクスポートは .txt / コピー。
```

### 1.3 入力

| 項目 | 現状 |
|------|------|
| 企業リストの取得 | **なし**。ユーザーが **1件ずつ URL を手入力**。 |
| Google 検索 | 未実装。 |
| 業界・地域などの条件検索 | 未実装。 |

### 1.4 情報取得（企業HP＋周辺）

| 項目 | 現状 |
|------|------|
| 企業公式 HP | ✅ 同一ドメイン内をクロール（最大8ページ）。 |
| HP 内 IR 情報 PDF | **未対応**。PDF の取得・テキスト抽出なし。 |
| Google 上の企業情報（概要・ニュース等） | **未対応**。HP のみ。 |
| 動画の読み込み / 動画 URL 抽出 | **未対応**。 |

### 1.5 LLM による要約・仮説生成

| 項目 | 現状 |
|------|------|
| 事業内容の要約 | ✅ あり（summaryBusiness）。業種・従業員規模も抽出。 |
| IR 内容（PDF）の要約 | ❌ PDF 未取得のためなし。 |
| その他企業情報の要約 | △ HP 内テキストのみを要約。 |
| 代表者名（代表者/役員等） | **未対応**。抽出・出力なし。 |
| 「課題仮説 → 提案」形式の手紙下書き | ✅ 仮説5段 + 提案文下書き（letterDraft）。 |
| 断定を避けた仮説表現 | ✅ プロンプトで「断定を避ける」指示あり。 |

### 1.6 出力

| 項目 | 現状 |
|------|------|
| Google スプレッドシート | **未対応**。 |
| Google ドキュメント | **未対応**。 |
| CSV | **未対応**。 |
| アプリ内表示 | ✅ 要約・仮説5段・提案文を表示。 |
| ファイル出力 | ✅ .txt エクスポート（UTF-8）。コピー対応。 |
| DB 保存 | ✅ ログインユーザーごとに runs テーブルに保存。 |

---

## 2. 依頼要件の整理（業務範囲）

### ① リスト作成（Google検索 → 企業HP抽出）

- 指定条件（業界・地域など）で Google 検索。
- 検索結果から企業名・企業HP URL を抽出。
- 出力先：Google スプレッドシート または CSV。
- Google の仕様・規約に配慮（API 利用案も歓迎）。

### ② 企業情報取得（企業HP＋周辺情報）

- 企業公式 HP。
- HP 内 IR 情報 PDF など。
- Google 上の企業情報（概要・ニュース等）。
- （可能なら）動画も読み込み、難しければ動画 URL 抽出まで。

### ③ LLM による要約・仮説生成

- 事業内容の要約。
- IR 内容（PDF）の要約。
- その他企業情報の要約。
- 代表者名（分かれば：代表者/役員等）。
- 「課題仮説 → 提案」形式の手紙下書き生成。

### ④ 出力（必須）

- Google スプレッドシートに  
  **企業名 / URL / 要約 / 仮説 / 代表者名（任意）/ 手紙下書き** を整形して出力。
- 手紙下書きは Google ドキュメント出力も可（運用しやすい形で提案）。

### その他

- **成果物**: Python スクリプト一式・設定ファイル・出力フォーマット・簡易マニュアル。
- **技術要件**: Python、生成 AI API、Web 情報取得、PDF 取得・テキスト抽出・要約、Google スプレッドシート/Docs への書き込み。
- **歓迎**: Playwright/Selenium、LlamaIndex/LangChain、エラー耐性（リトライ・ログ・例外処理）。
- **注意**: UI/アプリ開発は不要（管理画面なし）。生成文は仮説として。自動送信は行わない。スクレイピングは規約・robots 等に配慮。

---

## 3. 要件 vs 既存アプリ 照合表

| 要件 | 既存アプリの状況 | 判定 |
|------|------------------|------|
| **① リスト作成** | | |
| Google 検索で企業リスト取得 | 未実装（URL は手入力） | ❌ 未対応 |
| 条件（業界・地域等）指定 | 未実装 | ❌ 未対応 |
| 企業名・HP URL 抽出 → スプレッドシート/CSV | 未実装 | ❌ 未対応 |
| **② 企業情報取得** | | |
| 企業公式 HP | 同一ドメイン最大8ページ・robots 尊重 | ✅ 対応済み |
| HP 内 IR 情報 PDF | 未実装 | ❌ 未対応 |
| Google 上の企業情報（概要・ニュース） | 未実装 | ❌ 未対応 |
| 動画読み込み / 動画 URL 抽出 | 未実装 | ❌ 未対応 |
| **③ LLM 要約・仮説** | | |
| 事業内容要約 | あり（業種・従業員規模含む） | ✅ 対応済み |
| IR（PDF）要約 | PDF 未取得のため不可 | ❌ 未対応 |
| その他企業情報要約 | HP 内テキストのみ要約 | △ 部分 |
| 代表者名（代表者/役員等） | 未実装 | ❌ 未対応 |
| 課題仮説→提案の手紙下書き | 仮説5段 + 提案文 | ✅ 対応済み |
| 断定を避けた仮説表現 | プロンプトで指示 | ✅ 対応済み |
| **④ 出力** | | |
| スプレッドシート出力（企業名/URL/要約/仮説/決裁者/手紙） | 未実装 | ❌ 未対応 |
| Google ドキュメント（手紙下書き） | 未実装 | ❌ 未対応 |
| **形態・技術** | | |
| Python 実装 | Next.js/TypeScript（Node.js） | ⚠️ 方針違い |
| UI なし（管理画面なし） | Web UI あり | ⚠️ 方針違い |
| 生成 AI API（OpenAI/Claude 等） | Groq API 使用 | △ 別 API で同等可能 |
| PDF 取得・テキスト抽出・要約 | 未実装 | ❌ 未対応 |
| Google API（Sheet/Docs 書き込み） | 未実装 | ❌ 未対応 |
| エラー耐性（リトライ・ログ・例外） | タイムアウト・エラーコード・メッセージあり | △ 一部対応 |

---

## 4. まとめ：ギャップと位置づけ

### 4.1 既存アプリでカバーできている部分

- **企業 HP のクロール**（同一ドメイン・規約配慮・構造化）
- **HP テキストの要約 → 仮説5段 → 提案文下書き**（断定を避けた表現）
- **アプリ内での編集・保存・. txt エクスポート・コピー**

### 4.2 要件に対して不足している主な点

1. **リスト作成**  
   Google 検索・条件指定・企業名/URL 抽出・スプレッドシート/CSV 出力がすべて未実装。
2. **情報源の拡張**  
   IR PDF・Google 上の企業情報・動画（または動画 URL）が未対応。
3. **代表者名**  
   代表者/役員等の抽出・出力が未実装。
4. **出力先**  
   Google スプレッドシート・Google ドキュメント・CSV が未実装。
5. **形態**  
   要件は「Python・UI なし」、現状は「Next.js・Web UI あり」。

### 4.3 位置づけの整理

- **依頼要件**: 「リスト作成 → 企業情報取得 → 要約・仮説・手紙 → **スプレッドシート/ドキュメント出力**」までを **Python スクリプト（UI なし）** で一気に実行するバッチ的な成果物。
- **HypoFrame（現状）**: **1 企業ずつ URL を入力**し、**HP のみ**を元に要約・仮説・手紙を生成し、**画面表示と .txt/DB** で完結する **Web アプリ**。

そのため、

- **MVP のコア**（「Google→企業URL抽出 → HP/IR取得 → 要約 → 手紙下書き → スプレッドシート出力」）のうち、  
  HypoFrame と重なるのは **「HP 取得 → 要約 → 手紙下書き」** まで。
- **リスト作成・PDF/Google 情報・代表者名・スプレッドシート/Docs 出力・Python 化**は、いずれも HypoFrame の現状では未対応であり、要件を満たすには別モジュールまたは別システムの追加が必要。

---

## 5. 今後の検討の例（要件に近づける場合）

要件に合わせて拡張する場合の検討例（実装可否・優先度は別途判断）。

| 検討項目 | 内容 |
|----------|------|
| リスト作成 | Google Custom Search API 等で検索 → 企業名・URL 抽出。規約・利用制限の確認。 |
| PDF（IR） | HP 内 PDF リンクを検出し、PDF 取得・テキスト抽出（例: pdf-parse）→ 要約を LLM に追加入力。 |
| 代表者名 | 構造化テキストや「代表者」「役員」周辺を正規表現/LLM で抽出し、要約または専用フィールドで出力。 |
| 出力先 | Google Sheets API / Google Docs API で書き込み。または CSV 出力スクリプトを別途用意。 |
| Python 版 | 既存の「クロール→構造化→要約→仮説→手紙」ロジックを Python に移植し、API やバッチとして実行。UI は持たない。 |

上記は「要件との照合」に基づく検討リストであり、実装順序・採用可否は別ドキュメントまたは仕様で決定する。
