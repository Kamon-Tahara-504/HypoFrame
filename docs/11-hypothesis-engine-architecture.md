# 仮説生成エンジン アーキテクチャ（3層設計）

本ドキュメントは、仮説生成エンジンの設計前提・3層アーキテクチャ・優先ページ取得ロジックを定義する。制度検証（論理一貫性の検証）を主目的とした構造とする。

---

## 1. 設計前提

- **情報源**: 企業の公式ホームページのみ
- **外部情報**: 参照しない
- **遷移**: 同一ドメイン内のみ
- **最大取得ページ数**: 8ページ
- **目的**: 実用化よりも制度設計（論理一貫性）の検証を優先する
- **構造化レイヤー**: 仮説生成前に必ず挟む

---

## 2. 全体アーキテクチャ（3層）

| 層 | 役割 |
|----|------|
| **Page Collector（情報収集層）** | トップURLから同一ドメイン内リンクを抽出し、優先順位に基づき最大8ページまで取得する。 |
| **Structurizer（構造化層）** | HTMLから本文を抽出し、ナビゲーション・フッター等の不要要素を除去。会社概要・事業内容・採用情報などカテゴリ別に整理する。解釈・仮説生成は行わない。 |
| **Hypothesis Engine（仮説生成層）** | 構造化済みデータを入力とし、①企業の現在状況整理 → ②潜在課題の仮説 → ③課題の背景要因 → ④改善機会（介入ポイント）→ ⑤提案仮説 → ⑥提案文下書きの順で出力する。因果関係を明示し、飛躍を防ぐ設計とする。 |

---

## 3. 現状のコードとの対応

| 設計レイヤー | 現状の該当 | ギャップ |
|-------------|------------|----------|
| **Page Collector** | `lib/crawl.ts` | 最大3ページ・優先スコアなし・深度制限なし → **8ページ・URL優先ロジック・深度2** に変更 |
| **Structurizer** | なし（crawl が body を直結合） | **新規**。HTML→本文抽出・不要要素除去・カテゴリ別整理（解釈・仮説は行わない） |
| **Hypothesis Engine** | `lib/groq.ts` + `lib/prompts.ts` | 入力が「要約済み1本」→ **構造化済みデータ**に変更可能。出力①〜⑥は既存で一致 |

---

## 4. 優先ページ取得ロジック（Page Collector）

- **トップページ**: 必須取得
- **優先候補パス**: `/company`, `/about`, `/recruit`, `/careers`, `/service`, `/business` 等を URL パスのキーワードでスコアリングする
- **階層深度**: 最大2まで（トップを depth 0、トップから1クリックを depth 1、その先を depth 2 とし、depth 2 までの URL のみ取得対象）

